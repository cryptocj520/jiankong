<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backpack Exchange ä»·æ ¼ç›‘æ§</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
            background-color: #e8f4fd;
        }
        .price-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .price-table th, .price-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .price-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .price-table tr:hover {
            background-color: #f9f9f9;
        }
        .positive {
            color: #28a745;
        }
        .negative {
            color: #dc3545;
        }
        .alert {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            border-left: 5px solid #ffc107;
            display: none;
        }
        .config-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .config-section h3 {
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0069d9;
        }
        #coinList {
            width: 100%;
            height: 100px;
        }
        #log {
            height: 200px;
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            margin-top: 20px;
        }
        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Backpack Exchange ä»·æ ¼ç›‘æ§</h1>
        
        <div class="status" id="statusBar">
            <p>çŠ¶æ€: æœªè¿æ¥</p>
            <p>æ›´æ–°æ—¶é—´: --</p>
        </div>
        
        <div class="alert" id="priceAlert">
            <h3>ä»·å·®æé†’</h3>
            <p id="alertTime"></p>
            <p id="alertCoin"></p>
            <p id="alertSpotPrice"></p>
            <p id="alertPerpPrice"></p>
            <p id="alertDifference"></p>
            <p id="alertMessage"></p>
        </div>
        
        <table class="price-table" id="priceTable">
            <thead>
                <tr>
                    <th>å¸ç§</th>
                    <th>ç°è´§ä»·æ ¼</th>
                    <th>æ°¸ç»­åˆçº¦ä»·æ ¼</th>
                    <th>ä»·å·®(ç»å¯¹å€¼)</th>
                    <th>ä»·å·®(ç™¾åˆ†æ¯”)</th>
                </tr>
            </thead>
            <tbody id="priceTableBody">
                <!-- ä»·æ ¼æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </tbody>
        </table>
        
        <div class="config-section">
            <h3>é…ç½®è®¾ç½®</h3>
            <div class="form-group">
                <label for="apiKey">API Key:</label>
                <input type="text" id="apiKey" placeholder="è¾“å…¥æ‚¨çš„API Key">
            </div>
            <div class="form-group">
                <label for="apiSecret">API Secret:</label>
                <input type="text" id="apiSecret" placeholder="è¾“å…¥æ‚¨çš„API Secret">
            </div>
            <div class="form-group">
                <label for="coinList">ç›‘æ§å¸ç§ (æ¯è¡Œä¸€ä¸ª):</label>
                <textarea id="coinList">BTC
ETH
SOL
LINK
JUP</textarea>
            </div>
            <div class="form-group">
                <label for="threshold">ä»·å·®é˜ˆå€¼ (%):</label>
                <input type="number" id="threshold" value="0.01" step="0.01" min="0">
            </div>
            <div class="form-group">
                <label for="alertInterval">æé†’é—´éš” (åˆ†é’Ÿ):</label>
                <input type="number" id="alertInterval" value="15" min="1">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="disableDeduplication"> ç¦ç”¨é˜²é‡å¤æé†’
                </label>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="showPriceTable" checked> æ˜¾ç¤ºä»·æ ¼è¡¨æ ¼
                </label>
            </div>
            <div class="form-group">
                <label for="refreshInterval">åˆ·æ–°é—´éš” (æ¯«ç§’):</label>
                <input type="number" id="refreshInterval" value="5000" min="1000" step="1000">
            </div>
            <button id="applyConfig">åº”ç”¨é…ç½®</button>
            <button id="connectBtn">è¿æ¥</button>
            <button id="disconnectBtn" disabled>æ–­å¼€è¿æ¥</button>
        </div>
        
        <div id="log">
            <div class="log-entry">å‡†å¤‡å°±ç»ªï¼Œè¯·é…ç½®å¹¶è¿æ¥...</div>
        </div>
    </div>

    <script>
        // é…ç½®å¯¹è±¡
        let config = {
            apiKey: '',
            apiSecret: '',
            coins: ['BTC', 'ETH', 'SOL', 'LINK', 'JUP'],
            priceAlerts: {
                thresholdPercentage: 0.01,
                disableDeduplication: false,
                alertInterval: 15
            },
            display: {
                refreshInterval: 5000,
                showPriceTable: true
            }
        };

        // ä»·æ ¼å­˜å‚¨
        const prices = {
            spot: {},
            perp: {}
        };

        // ç”¨äºè®°å½•å·²ç»æé†’è¿‡çš„å¸ç§ä»·å·®ï¼Œé¿å…é‡å¤æé†’
        const alertedPairs = new Set();

        // WebSocketå¯¹è±¡
        let ws = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;

        // DOMå…ƒç´ 
        const statusBar = document.getElementById('statusBar');
        const priceTable = document.getElementById('priceTable');
        const priceTableBody = document.getElementById('priceTableBody');
        const priceAlert = document.getElementById('priceAlert');
        const log = document.getElementById('log');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const applyConfigBtn = document.getElementById('applyConfig');

        // å·¥å…·å‡½æ•°
        function formatPrice(price) {
            return parseFloat(price).toFixed(2);
        }

        function formatPremium(premium) {
            const value = parseFloat(premium).toFixed(4);
            const sign = value > 0 ? '+' : '';
            return `${sign}${value}`;
        }

        function formatPercentage(percentage) {
            const value = parseFloat(percentage).toFixed(4);
            const sign = value > 0 ? '+' : '';
            return `${sign}${value}%`;
        }

        function addLogEntry(message) {
            const now = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${now}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // æ›´æ–°çŠ¶æ€æ 
        function updateStatus(message) {
            const now = new Date().toLocaleTimeString();
            statusBar.innerHTML = `
                <p>çŠ¶æ€: ${message}</p>
                <p>æ›´æ–°æ—¶é—´: ${now}</p>
            `;
        }

        // åˆ›å»ºç­¾åï¼ˆå®¢æˆ·ç«¯ä¸å®‰å…¨ï¼Œä»…ä½œæ¼”ç¤ºï¼‰
        function createSignature(timestamp, method, path, body) {
            // æ³¨æ„ï¼šåœ¨çœŸå®åº”ç”¨ä¸­ï¼Œè¿™ç§ç­¾ååº”è¯¥åœ¨æœåŠ¡å™¨ç«¯å®Œæˆ
            // è¿™é‡Œåªæ˜¯æ¼”ç¤ºï¼Œä¸èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
            addLogEntry("è­¦å‘Š: åœ¨æµè§ˆå™¨ä¸­åˆ›å»ºç­¾åä¸å®‰å…¨ï¼Œä»…ä¾›æ¼”ç¤º");
            return "demo-signature";
        }

        // æ˜¾ç¤ºä»·æ ¼è¡¨æ ¼
        function displayPrices() {
            if (!config.display.showPriceTable) {
                priceTable.style.display = 'none';
                return;
            } else {
                priceTable.style.display = 'table';
            }
            
            // æ›´æ–°çŠ¶æ€
            updateStatus('å·²è¿æ¥');
            
            // æ¸…ç©ºè¡¨æ ¼
            priceTableBody.innerHTML = '';
            
            // å¡«å……æ•°æ®
            for (const coin of config.coins) {
                const spotSymbol = `${coin}_USDC`;
                const perpSymbol = `${coin}_USDC_PERP`;
                
                const spotPrice = prices.spot[spotSymbol];
                const perpPrice = prices.perp[perpSymbol];
                
                const row = document.createElement('tr');
                
                if (spotPrice && perpPrice) {
                    // è®¡ç®—ä»·å·®
                    const premium = perpPrice - spotPrice;
                    const percentage = (premium / spotPrice) * 100;
                    const percentageClass = premium >= 0 ? 'positive' : 'negative';
                    
                    row.innerHTML = `
                        <td>${coin}</td>
                        <td>${formatPrice(spotPrice)}</td>
                        <td>${formatPrice(perpPrice)}</td>
                        <td>${formatPremium(premium)}</td>
                        <td class="${percentageClass}">${formatPercentage(percentage)}</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td>${coin}</td>
                        <td colspan="4">ç­‰å¾…æ•°æ®...</td>
                    `;
                }
                
                priceTableBody.appendChild(row);
            }
        }

        // æ£€æŸ¥ä»·å·®å¹¶æ˜¾ç¤ºæé†’
        function checkPriceDifference(coin, spotPrice, perpPrice) {
            // è®¡ç®—ä»·å·®
            const premium = perpPrice - spotPrice;
            const percentage = (premium / spotPrice) * 100;
            const absPercentage = Math.abs(percentage);
            
            // é˜ˆå€¼æ£€æŸ¥
            if (absPercentage >= config.priceAlerts.thresholdPercentage) {
                const now = new Date().toLocaleTimeString();
                const alertKey = `${coin}_${Math.floor(percentage * 100)}`;
                
                // å¦‚æœè¿™ä¸ªä»·å·®æ²¡æœ‰è¢«æé†’è¿‡ï¼Œæˆ–è€…ç¦ç”¨äº†é˜²é‡å¤æœºåˆ¶ï¼Œæ‰æ˜¾ç¤ºæé†’
                if (config.priceAlerts.disableDeduplication || !alertedPairs.has(alertKey)) {
                    // æ·»åŠ åˆ°å·²æé†’é›†åˆ
                    alertedPairs.add(alertKey);
                    
                    // è®¾å®šæ—¶é—´åè‡ªåŠ¨ä»å·²æé†’é›†åˆä¸­ç§»é™¤ï¼Œå…è®¸å†æ¬¡æé†’
                    setTimeout(() => {
                        alertedPairs.delete(alertKey);
                    }, config.priceAlerts.alertInterval * 60 * 1000);
                    
                    // æ˜¾ç¤ºæé†’
                    const premiumType = percentage > 0 ? 'æº¢ä»·' : 'æŠ˜ä»·';
                    
                    // æ›´æ–°æé†’æ¡†å†…å®¹
                    document.getElementById('alertTime').textContent = `æ—¶é—´: ${now}`;
                    document.getElementById('alertCoin').textContent = `å¸ç§: ${coin}`;
                    document.getElementById('alertSpotPrice').textContent = `ç°è´§ä»·æ ¼: ${formatPrice(spotPrice)}`;
                    document.getElementById('alertPerpPrice').textContent = `åˆçº¦ä»·æ ¼: ${formatPrice(perpPrice)}`;
                    document.getElementById('alertDifference').textContent = `ä»·å·®: ${formatPremium(premium)} (${formatPercentage(percentage)})`;
                    document.getElementById('alertMessage').textContent = `æé†’: ${coin} æ°¸ç»­åˆçº¦${premiumType}è¶…è¿‡é˜ˆå€¼ ${config.priceAlerts.thresholdPercentage}%`;
                    
                    // æ˜¾ç¤ºæé†’æ¡†
                    priceAlert.style.display = 'block';
                    
                    // æ·»åŠ åˆ°æ—¥å¿—
                    addLogEntry(`ä»·å·®æé†’: ${coin} æ°¸ç»­åˆçº¦${premiumType}è¶…è¿‡é˜ˆå€¼ ${config.priceAlerts.thresholdPercentage}%`);
                    
                    // å¦‚æœæ”¯æŒæµè§ˆå™¨é€šçŸ¥ï¼Œå‘é€é€šçŸ¥
                    if (Notification.permission === "granted") {
                        new Notification("Backpack Exchange ä»·å·®æé†’", {
                            body: `${coin} æ°¸ç»­åˆçº¦${premiumType}è¶…è¿‡é˜ˆå€¼ ${config.priceAlerts.thresholdPercentage}%`,
                            icon: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' height='24' width='24'><text x='0' y='20' fill='black'>ğŸ’°</text></svg>"
                        });
                    }
                    
                    // ä¸€æ®µæ—¶é—´åè‡ªåŠ¨éšè—æé†’
                    setTimeout(() => {
                        priceAlert.style.display = 'none';
                    }, 10000);
                    
                    return true;
                }
            } else {
                // å¦‚æœä»·å·®ä½äºé˜ˆå€¼ï¼Œä»å·²æé†’é›†åˆä¸­ç§»é™¤
                const alertKey = `${coin}_${Math.floor(percentage * 100)}`;
                alertedPairs.delete(alertKey);
            }
            
            return false;
        }

        // è¿æ¥åˆ°WebSocket
        function connectWebSocket() {
            // æ£€æŸ¥API Keyå’ŒSecretæ˜¯å¦å·²è®¾ç½®
            if (!config.apiKey || !config.apiSecret) {
                addLogEntry("é”™è¯¯: è¯·å…ˆè®¾ç½®API Keyå’ŒSecret");
                return;
            }
            
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            connectBtn.disabled = true;
            disconnectBtn.disabled = false;
            
            try {
                // å®é™…è¿æ¥ä»£ç 
                addLogEntry("æ­£åœ¨è¿æ¥åˆ°Backpack Exchange...");
                updateStatus('æ­£åœ¨è¿æ¥...');
                
                // åˆ›å»ºWebSocketè¿æ¥
                ws = new WebSocket('wss://ws.backpack.exchange');
                
                // è¿æ¥æ‰“å¼€æ—¶
                ws.onopen = function() {
                    addLogEntry("WebSocketè¿æ¥å·²å»ºç«‹");
                    reconnectAttempts = 0;
                    
                    // è®¢é˜…ç°è´§å’Œæ°¸ç»­åˆçº¦ä»·æ ¼
                    subscribeToMarkets();
                };
                
                // æ”¶åˆ°æ¶ˆæ¯æ—¶
                ws.onmessage = function(event) {
                    try {
                        const message = JSON.parse(event.data);
                        
                        // å¤„ç†tickeræ•°æ®
                        if (message.data && message.data.e === 'ticker') {
                            const symbol = message.data.s;
                            const price = parseFloat(message.data.c);
                            
                            // æ ¹æ®ç¬¦å·åˆ¤æ–­æ˜¯ç°è´§è¿˜æ˜¯åˆçº¦
                            if (symbol.endsWith('_PERP')) {
                                prices.perp[symbol] = price;
                                
                                // æå–å¸ç§åç§°
                                const coin = symbol.split('_')[0];
                                const spotSymbol = `${coin}_USDC`;
                                const spotPrice = prices.spot[spotSymbol];
                                
                                // å¦‚æœç°è´§ä»·æ ¼ä¹Ÿæœ‰äº†ï¼Œæ£€æŸ¥ä»·å·®
                                if (spotPrice) {
                                    checkPriceDifference(coin, spotPrice, price);
                                }
                            } else {
                                prices.spot[symbol] = price;
                                
                                // æå–å¸ç§åç§°
                                const coin = symbol.split('_')[0];
                                const perpSymbol = `${coin}_USDC_PERP`;
                                const perpPrice = prices.perp[perpSymbol];
                                
                                // å¦‚æœæ°¸ç»­åˆçº¦ä»·æ ¼ä¹Ÿæœ‰äº†ï¼Œæ£€æŸ¥ä»·å·®
                                if (perpPrice) {
                                    checkPriceDifference(coin, prices.spot[symbol], perpPrice);
                                }
                            }
                            
                            // æ›´æ–°æ˜¾ç¤º
                            if (config.display.showPriceTable) {
                                displayPrices();
                            }
                        }
                        
                        // å¤„ç†è®¢é˜…å“åº”
                        if (message.result === "success") {
                            addLogEntry(`è®¢é˜…æˆåŠŸ: ${message.id}`);
                        }
                        
                        // å¤„ç†é”™è¯¯
                        if (message.error) {
                            addLogEntry(`WebSocketé”™è¯¯: ${JSON.stringify(message.error)}`);
                        }
                        
                    } catch (e) {
                        // å¿½ç•¥è§£æé”™è¯¯
                    }
                };
                
                // å…³é—­æ—¶
                ws.onclose = function(event) {
                    updateStatus('å·²æ–­å¼€è¿æ¥');
                    addLogEntry(`WebSocketè¿æ¥å·²å…³é—­: ä»£ç =${event.code}, åŸå› =${event.reason}`);
                    connectBtn.disabled = false;
                    disconnectBtn.disabled = true;
                    
                    // å°è¯•é‡è¿
                    if (reconnectAttempts < maxReconnectAttempts) {
                        reconnectAttempts++;
                        addLogEntry(`å°è¯•é‡è¿ (${reconnectAttempts}/${maxReconnectAttempts})...`);
                        setTimeout(connectWebSocket, 5000);
                    } else {
                        addLogEntry(`å·²è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•° (${maxReconnectAttempts})`);
                    }
                };
                
                // é”™è¯¯æ—¶
                ws.onerror = function(error) {
                    addLogEntry("WebSocketé”™è¯¯: " + error.message);
                };
                
            } catch (error) {
                addLogEntry("è¿æ¥é”™è¯¯: " + error.message);
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
            }
        }

        // è®¢é˜…è¡Œæƒ…
        function subscribeToMarkets() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addLogEntry("é”™è¯¯: WebSocketæœªè¿æ¥");
                return;
            }
            
            // ç”Ÿæˆç°è´§å’Œæ°¸ç»­åˆçº¦ç¬¦å·
            const spotSymbols = config.coins.map(coin => `${coin}_USDC`);
            const perpSymbols = config.coins.map(coin => `${coin}_USDC_PERP`);
            
            // è®¢é˜…ç°è´§
            const spotChannels = spotSymbols.map(symbol => `ticker.${symbol}`);
            const spotSubscribeParams = {
                method: 'SUBSCRIBE',
                params: spotChannels,
                id: 1
            };
            
            // è®¢é˜…æ°¸ç»­åˆçº¦
            const perpChannels = perpSymbols.map(symbol => `ticker.${symbol}`);
            const perpSubscribeParams = {
                method: 'SUBSCRIBE',
                params: perpChannels,
                id: 2
            };
            
            // å‘é€è®¢é˜…è¯·æ±‚
            ws.send(JSON.stringify(spotSubscribeParams));
            addLogEntry(`è®¢é˜…ç°è´§: ${spotSymbols.join(', ')}`);
            
            ws.send(JSON.stringify(perpSubscribeParams));
            addLogEntry(`è®¢é˜…æ°¸ç»­åˆçº¦: ${perpSymbols.join(', ')}`);
            
            // æ˜¾ç¤ºåˆå§‹ç•Œé¢
            if (config.display.showPriceTable) {
                displayPrices();
            } else {
                priceTable.style.display = 'none';
                addLogEntry("ä»·æ ¼ç›‘æ§å·²å¯åŠ¨ï¼Œå°†åœ¨ä»·å·®è¶…è¿‡é˜ˆå€¼æ—¶æ˜¾ç¤ºæé†’");
                addLogEntry(`å½“å‰ç›‘æ§çš„å¸ç§: ${config.coins.join(', ')}`);
                addLogEntry(`ä»·å·®é˜ˆå€¼: ${config.priceAlerts.thresholdPercentage}%`);
            }
            
            // å®šæœŸåˆ·æ–°æ˜¾ç¤ºï¼ˆå³ä½¿æ²¡æœ‰æ–°æ•°æ®ï¼‰
            setInterval(() => {
                if (config.display.showPriceTable && ws.readyState === WebSocket.OPEN) {
                    displayPrices();
                }
            }, config.display.refreshInterval);
        }

        // æ–­å¼€è¿æ¥
        function disconnectWebSocket() {
            if (ws) {
                ws.close();
                addLogEntry("å·²ä¸»åŠ¨æ–­å¼€WebSocketè¿æ¥");
            }
            
            // é‡ç½®çŠ¶æ€
            connectBtn.disabled = false;
            disconnectBtn.disabled = true;
        }

        // åº”ç”¨é…ç½®
        function applyConfig() {
            // è¯»å–è¡¨å•å€¼
            config.apiKey = document.getElementById('apiKey').value;
            config.apiSecret = document.getElementById('apiSecret').value;
            config.coins = document.getElementById('coinList').value.split('\n').map(c => c.trim()).filter(c => c);
            
            config.priceAlerts.thresholdPercentage = parseFloat(document.getElementById('threshold').value);
            config.priceAlerts.alertInterval = parseInt(document.getElementById('alertInterval').value);
            config.priceAlerts.disableDeduplication = document.getElementById('disableDeduplication').checked;
            
            config.display.showPriceTable = document.getElementById('showPriceTable').checked;
            config.display.refreshInterval = parseInt(document.getElementById('refreshInterval').value);
            
            // æ¸…ç©ºä¹‹å‰çš„é›†åˆ
            alertedPairs.clear();
            
            addLogEntry("å·²åº”ç”¨æ–°é…ç½®");
            addLogEntry(`ç›‘æ§å¸ç§: ${config.coins.join(', ')}`);
            addLogEntry(`ä»·å·®é˜ˆå€¼: ${config.priceAlerts.thresholdPercentage}%`);
            
            // å¦‚æœå½“å‰å·²è¿æ¥ï¼Œåˆ™é‡æ–°è¿æ¥ä»¥åº”ç”¨æ–°é…ç½®
            if (ws && ws.readyState === WebSocket.OPEN) {
                addLogEntry("é‡æ–°è¿æ¥ä»¥åº”ç”¨æ–°é…ç½®...");
                disconnectWebSocket();
                setTimeout(connectWebSocket, 1000);
            }
        }

        // åˆå§‹åŒ–
        function init() {
            // åŠ è½½è¡¨å•é»˜è®¤å€¼
            document.getElementById('threshold').value = config.priceAlerts.thresholdPercentage;
            document.getElementById('alertInterval').value = config.priceAlerts.alertInterval;
            document.getElementById('disableDeduplication').checked = config.priceAlerts.disableDeduplication;
            document.getElementById('showPriceTable').checked = config.display.showPriceTable;
            document.getElementById('refreshInterval').value = config.display.refreshInterval;
            
            // è¯·æ±‚æµè§ˆå™¨é€šçŸ¥æƒé™
            if (Notification.permission !== "granted" && Notification.permission !== "denied") {
                Notification.requestPermission();
            }
            
            // ç»‘å®šäº‹ä»¶
            connectBtn.addEventListener('click', connectWebSocket);
            disconnectBtn.addEventListener('click', disconnectWebSocket);
            applyConfigBtn.addEventListener('click', applyConfig);
            
            // åˆå§‹åŒ–ç•Œé¢
            displayPrices();
            addLogEntry("ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œè¯·é…ç½®APIå¯†é’¥å¹¶è¿æ¥");
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);

        // å¤„ç†é¡µé¢å…³é—­
        window.addEventListener('beforeunload', () => {
            if (ws) {
                ws.close();
            }
        });
    </script>
</body>
</html> 